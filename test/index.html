<!doctype html>
<html>
<head>
<title>test</title>
<script src="require.js"></script>
<style>
.test {
	position: relative;
}
</style>
</head>
<body>
<input id="range" type="range" min=0 max=40 value=1>
<button class="undo test">Undo</button>
<div class="test">Lorem ipsum dolor sit amet</div>
<div class="test">Lorem ipsum dolor sit amet</div>
<script>
require.config({
	baseUrl: '..',
	paths: {
		mori: 'node_modules/mori/mori',
		nbd: 'node_modules/nbd'
	}
});

require(['lib/CSSPipeline'], function(Pipeline) {
	var pipe = new Pipeline();

	var node = document.querySelectorAll('.test');
	var range = document.getElementById('range');
	range.addEventListener('input', function() {
		pipe.process(node, { margin: +this.value });
	});

	var topShader = {
		main: function(input, mori) {
			return mori.assoc(this._state,
				'top', input.margin + 'px',
				'position', 'relative');
		}
	},
	centerShader = {
		main: function(input, mori) {
			if (input.margin == 0) {
				return mori.hash_map(
					'width', '200px',
					'marginLeft', 'auto',
					'marginRight', 'auto',
					'display', 'block');
			}
		}
	};
	pipe.push(topShader, centerShader);
});
</script>
</body>
</html>
